---
import InputAddMember from '@/components/team/add-member/InputAddMember.astro';
import Layout from '@/layouts/Layout.astro';
---

<Layout title="Create a team">
  <div class="max-w-2xl mx-auto mt-10 text-center">
    <h1 class="text-3xl font-bold mb-6">Create a New Team</h1>
    <p class="text-gray-600">Fill out the form below to create a new team.</p>
  </div>

  <form class="p-8 m-8 border rounded-md">
    <label for="team-name" class="block mb-4">
      Team Name
      <input
        type="text"
        name="team-name"
        required
        class="block w-full mt-2 p-2 border rounded-lg"
        placeholder="e.g. Marketing Team"
      />
    </label>
    <label for="team-description" class="block mb-4">
      Team Description
      <input
        type="text"
        name="team-description"
        class="block w-full mt-2 p-2 border rounded-lg"
        placeholder="e.g. Responsible for all marketing activities"
      />
    </label>
    <label for="invite-members" class="block mb-4">
      Invite Members
      <input
        type="text"
        name="invite-members"
        class="block w-full mt-2 p-2 border rounded-lg"
        placeholder="Enter email addresses..."
      />
    </label>

    <button
      type="submit"
      id="create-team"
      class="bg-sky-500 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg"
      >Save changes</button
    >
  </form>

  <script>
    import { actions } from 'astro:actions';

    const button = document.getElementById('create-team') as HTMLButtonElement;
    const form = document.querySelector('form') as HTMLFormElement;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      button.innerText = 'Creating...';

      const formData = new FormData(form);
      const teamName = formData.get('team-name');
      const teamDescription = formData.get('team-description');
      const inviteMembers = formData.get('invite-members');

      const teamData = {
        name: teamName as string,
        description: teamDescription as string,
      };

      const { data: team, error } = await actions.createTeam(teamData);

      if (error) {
        button.innerText = 'Save changes';
        alert('Error creating team: ' + error.message);
        return;
      }

      button.innerText = 'Save changes';
      form.reset();
      alert('Team created successfully!');

      if (team.id) {
        window.location.replace(`/teams/${team.id}`);
      }
    });
  </script>
</Layout>
